var J=Object.defineProperty;var q=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var I=(e,t,o)=>t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,y=(e,t)=>{for(var o in t||(t={}))K.call(t,o)&&I(e,o,t[o]);if(q)for(var o of q(t))Q.call(t,o)&&I(e,o,t[o]);return e};import{_ as W}from"./actions-b79a095e.mjs";import{_ as X,u as D,j as Y,r as c,o as n,c as f,d,a as l,w as i,i as m,k as u,l as p,n as _,m as v,g as T,F as U,e as A,p as N,t as Z,h as g}from"./entry-c6c6a655.mjs";const $={props:{namespace:{default:""},actionsExcept:{default:()=>[],type:Array},singular:{default:"Item"},plural:{default:"Itens"},searchFluid:{default:!1},editFluid:{default:!1}},watch:{$route:{deep:!0,handler(e,t){this.searchInit(),this.editInit()}}},methods:{slotBind(e={}){return y({edit:this.modelEdit.data,search:this.modelSearch,editUpdate:this.editUpdate,searchSubmit:this.searchSubmit},e)},navigateBack(){this.$router.push(`/admin/${this.namespace}`)},saveSuccess(e){this.editUpdate(e.data),this.$router.push({query:{id:e.data.id}})},async editInit(){this.modelEdit.status=!1,this.modelEdit.data={};let e=this.$route.query.id||!1;if(!e||isNaN(e))return;let t=await this.$axios.get(`/api/${this.namespace}/find/${e}`);this.modelEdit.data=t.data,this.app.setTitle(`Editar ${this.singular} | ${t.data.name}`)},editUpdate(e){this.modelEdit.data=e},async searchInit(){this.$route.query.id||(this._searchInitTimeout&&clearTimeout(this._searchInitTimeout),this._searchInitTimeout=setTimeout(async()=>{this.tableSearchCols=this.$el.querySelectorAll(".ui-crud-search-table thead th").length,this.modelSearch.params=this.paramsDefault(this.$route.query),this.app.setTitle(`Pesquisar ${this.plural}`),this.selects=[],this.modelSearch.cancel(),await this.modelSearch.submit(),this.$emit("search",this.slotBind())},10))},async searchSubmit(){setTimeout(()=>{this.$router.push({query:this.modelSearch.params})},100)},searchSelectAll(e){if(!e)return this.selects=[];let t=[];this.modelSearch.resp.data.forEach(o=>{t.push(o.id)}),this.selects=t},exportDownload(e){this.$axios.get(e.url).then(t=>{Object.assign(document.createElement("a"),{href:t.data.base64,download:t.data.name}).click()})},paramsDefault(e={}){return e=y({q:"",page:1,per_page:10},e),e.page=parseInt(e.page),e.per_page=parseInt(e.per_page),e},searchDelete(e=null){e=Array.isArray(e)?e:this.selects;let t=this.$filters.singularPlural(e.length,this.singular,this.plural);this.$confirm(`Deletar ${e.length} ${t}?`).then(()=>{alert("aaa")})}},data(){return{tableSearchCols:2,selects:[],modelSearch:D({method:"get",url:`/api/${this.namespace}/search`,params:this.paramsDefault(this.$route.query)}),modelEdit:D({method:"post",url:`/api/${this.namespace}/save`,data:{}}),app:Y()}},mounted(){this.editInit(),this.searchInit()}},ee={key:0},te=g("Dados salvos"),se={key:1},le={class:"bg-white elevation-1"},ae={class:"text-uppercase"},oe={class:"pe-0",width:"30px"},ie=d("th",{width:"50px",class:"app-model-crud-table-actions"},null,-1),ne=["colspan"],de={key:0},re=["colspan"],ce={class:"pe-0"},ue={class:"app-model-crud-table-actions py-1"},he={class:"search-table-item-actions"},me={class:"d-flex align-center"},pe={class:"pa-2 d-none d-md-block"},_e={class:"flex-grow-1"},ve={class:"pa-2 d-none d-md-block"},fe=d("div",null,"Busca",-1),be=g(" Buscar "),Se=g(" Limpar ");function ye(e,t,o,ge,s,r){const k=c("v-progress-linear"),F=c("v-alert"),x=c("v-card-text"),w=c("v-card"),E=c("v-container"),h=c("v-btn"),B=W,S=c("v-col"),V=c("v-checkbox"),C=c("v-menu"),P=c("v-table"),j=c("v-divider"),L=c("v-pagination"),R=c("v-combobox"),z=c("v-card-header"),M=c("v-text-field"),O=c("v-row"),G=c("v-list-item"),H=c("v-list");return n(),f("div",null,[e.$route.query.id?(n(),f("div",ee,[d("form",{onSubmit:t[1]||(t[1]=T(a=>{s.modelEdit.submit().then(r.saveSuccess)},["prevent"]))},[l(E,{fluid:o.editFluid},{default:i(()=>[s.modelEdit.loading?(n(),m(k,{key:0,indeterminate:""})):u("",!0),s.modelEdit.status==200?(n(),m(F,{key:1,type:"success"},{default:i(()=>[te]),_:1})):u("",!0),p(e.$slots,"edit-card",_(v(r.slotBind())),()=>[l(w,null,{default:i(()=>[l(x,null,{default:i(()=>[p(e.$slots,"edit-fields",_(v(r.slotBind())))]),_:3})]),_:3})])]),_:3},8,["fluid"]),l(B,null,{default:i(()=>[l(h,{icon:"mdi-close",onClick:t[0]||(t[0]=a=>r.navigateBack())}),o.actionsExcept.includes("new")?u("",!0):(n(),m(h,{key:0,icon:"mdi-plus-circle",to:`/admin/${o.namespace}?id=new`},null,8,["to"])),l(h,{icon:"mdi-content-save",type:"submit"})]),_:1})],32)])):u("",!0),e.$route.query.id?u("",!0):(n(),f("div",se,[l(E,{fluid:o.searchFluid},{default:i(()=>[l(O,null,{default:i(()=>[e.$slots["search-header"]?(n(),m(S,{key:0,cols:"12"},{default:i(()=>[p(e.$slots,"search-header",_(v(r.slotBind())))]),_:3})):u("",!0),l(S,{cols:"12",md:"8"},{default:i(()=>[d("div",le,[p(e.$slots,"search-table",_(v(r.slotBind())),()=>[l(P,{"fixed-header":"",class:"ui-crud-search-table"},{default:i(()=>[d("thead",null,[d("tr",ae,[d("th",oe,[l(V,{onClick:t[2]||(t[2]=a=>r.searchSelectAll(a.target.checked)),"hide-details":!0,class:"mx-auto"})]),p(e.$slots,"search-table-header",_(v(r.slotBind()))),ie])]),d("tbody",null,[d("tr",null,[d("td",{colspan:s.tableSearchCols,class:"px-0",style:{height:"3px",border:"none"}},[s.modelSearch.loading?(n(),m(k,{key:0,indeterminate:"",color:"primary",height:"3"})):u("",!0)],8,ne)]),s.modelSearch.resp&&s.modelSearch.resp.data&&s.modelSearch.resp.data.length==0?(n(),f("tr",de,[d("td",{class:"text-center",colspan:s.tableSearchCols}," Nenhum resultado encontrado ",8,re)])):u("",!0),s.modelSearch.resp&&s.modelSearch.resp.data?(n(!0),f(U,{key:1},A(s.modelSearch.resp.data,a=>(n(),f("tr",{key:a.id},[d("td",ce,[l(V,{modelValue:s.selects,"onUpdate:modelValue":t[3]||(t[3]=b=>s.selects=b),value:a.id,"hide-details":!0,class:"mx-auto"},null,8,["modelValue","value"])]),p(e.$slots,"search-table-item",_(v(r.slotBind({item:a})))),d("td",ue,[l(C,{anchor:"start"},{activator:i(({props:b})=>[l(h,N({icon:"mdi-dots-vertical"},b,{flat:""}),null,16)]),default:i(()=>[d("div",he,[p(e.$slots,"search-table-item-actions",_(v(r.slotBind({item:a})))),o.actionsExcept.includes("edit")?u("",!0):(n(),m(h,{key:0,icon:"mdi-pencil",to:`/admin/${o.namespace}?id=${a.id}`},null,8,["to"])),o.actionsExcept.includes("delete")?u("",!0):(n(),m(h,{key:1,icon:"mdi-delete",onClick:b=>r.searchDelete([a.id])},null,8,["onClick"])),o.actionsExcept.includes("clone")?u("",!0):(n(),m(h,{key:2,icon:"mdi-content-copy"}))])]),_:2},1024)])]))),128)):u("",!0)])]),_:3})]),l(j),d("div",me,[d("div",pe,Z(s.modelSearch.resp.total)+" resultados ",1),d("div",_e,[s.modelSearch.resp&&s.modelSearch.resp.last_page?(n(),m(L,{key:0,modelValue:s.modelSearch.params.page,"onUpdate:modelValue":[t[4]||(t[4]=a=>s.modelSearch.params.page=a),t[5]||(t[5]=a=>r.searchSubmit())],length:s.modelSearch.resp.last_page},null,8,["modelValue","length"])):u("",!0)]),d("div",ve,[l(R,{modelValue:s.modelSearch.params.per_page,"onUpdate:modelValue":[t[6]||(t[6]=a=>s.modelSearch.params.per_page=a),t[7]||(t[7]=a=>r.searchSubmit())],items:[5,10,25,50,100],label:"Resultados por p\xE1gina","hide-details":!0,density:"compact"},null,8,["modelValue"])])])])]),_:3}),l(S,{cols:"12",md:"4"},{default:i(()=>[l(w,null,{default:i(()=>[l(z,null,{default:i(()=>[fe]),_:1}),l(x,null,{default:i(()=>[d("form",{onSubmit:t[10]||(t[10]=T(a=>r.searchSubmit(),["prevent"]))},[l(M,{label:"Buscar",modelValue:s.modelSearch.params.q,"onUpdate:modelValue":t[8]||(t[8]=a=>s.modelSearch.params.q=a)},null,8,["modelValue"]),p(e.$slots,"search-fields",_(v(r.slotBind()))),l(h,{type:"submit",color:"primary",block:"",disabled:s.modelSearch.loading,loading:s.modelSearch.loading},{default:i(()=>[be]),_:1},8,["disabled","loading"]),l(h,{type:"button",color:"white",block:"",class:"mt-3",onClick:t[9]||(t[9]=a=>s.modelSearch.clear().then(r.searchSubmit))},{default:i(()=>[Se]),_:1})],32)]),_:3})]),_:3})]),_:3})]),_:3})]),_:3},8,["fluid"]),l(B,null,{default:i(()=>[l(h,{icon:"mdi-magnify"}),o.actionsExcept.includes("new")?u("",!0):(n(),m(h,{key:0,icon:"mdi-plus-circle",to:`/admin/${o.namespace}?id=new`},null,8,["to"])),l(C,{anchor:"top"},{activator:i(({props:a})=>[l(h,N({icon:"mdi-cloud-download"},a),null,16)]),default:i(()=>[l(H,{style:{width:"180px"}},{default:i(()=>[(n(!0),f(U,null,A(s.modelSearch.resp.exportUrls,a=>(n(),m(G,{title:a.name,onClick:b=>r.exportDownload(a)},null,8,["title","onClick"]))),256))]),_:1})]),_:1}),s.selects.length&&!o.actionsExcept.includes("delete")?(n(),m(h,{key:1,icon:"mdi-delete",onClick:t[11]||(t[11]=a=>r.searchDelete())})):u("",!0)]),_:1})]))])}var Ee=X($,[["render",ye]]);export{Ee as _};
